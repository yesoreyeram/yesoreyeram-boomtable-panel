System.register(["lodash", "./BoomUtils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, BoomUtils_1, BoomOutput;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (BoomUtils_1_1) {
                BoomUtils_1 = BoomUtils_1_1;
            }
        ],
        execute: function () {
            BoomOutput = (function () {
                function BoomOutput(options) {
                    this.default_title_for_rows = options.default_title_for_rows || "";
                    this.hide_first_column = options.hide_first_column;
                    this.hide_headers = options.hide_headers;
                    this.text_alignment_firstcolumn = options.text_alignment_firstcolumn || "";
                    this.text_alignment_values = options.text_alignment_values || "";
                    this.first_column_link = options.first_column_link || "#";
                }
                return BoomOutput;
            }());
            exports_1("BoomOutput", BoomOutput);
            BoomOutput.prototype.getDataAsHTML = function (data, sorting_props) {
                var _this = this;
                var getLinkifiedColumn = function (rowName, first_column_link, raw_rowName) {
                    if (first_column_link !== "#") {
                        first_column_link = first_column_link.replace(new RegExp("_row_name_", "g"), BoomUtils_1.getActualNameWithoutTokens(raw_rowName).trim());
                        rowName = "<a href=\"" + first_column_link + "\" target=\"_blank\">" + rowName + "</a>";
                    }
                    return rowName;
                };
                var output = {
                    body: ""
                };
                if (sorting_props && sorting_props.col_index !== undefined && sorting_props.col_index > -1 && data && data.output && data.output.length >= sorting_props.col_index) {
                    var sortFunction_1 = function (a, b, sortMethod) {
                        if (sortMethod === "asc") {
                            return a[sorting_props.col_index].value - b[sorting_props.col_index].value;
                        }
                        else {
                            return b[sorting_props.col_index].value - a[sorting_props.col_index].value;
                        }
                    };
                    data.output = data.output
                        .filter(function (a) { return !isNaN(a[sorting_props.col_index].value); })
                        .concat(data.output.filter(function (a) { return isNaN(a[sorting_props.col_index].value); }))
                        .sort(function (a, b) { return sortFunction_1(a, b, sorting_props.direction); });
                }
                lodash_1.default.each(data.output, function (o) {
                    if (o.map(function (item) { return item.hidden.toString(); }).indexOf("false") > -1) {
                        output.body += "<tr>";
                        if (_this.hide_first_column !== true) {
                            var raw_rowName = (lodash_1.default.first(o.map(function (item) { return item.row_name_raw; })));
                            output.body += "\n                    <td style=\"padding:4px;text-align:" + _this.text_alignment_firstcolumn + "\">\n                        " + getLinkifiedColumn(lodash_1.default.first(o.map(function (item) { return item.row_name; })), String(_this.first_column_link), raw_rowName) + "\n                    </td>";
                        }
                        lodash_1.default.each(o, function (item) {
                            var item_style = "padding:4px;background-color:" + item.color_bg + ";color:" + item.color_text + ";text-align:" + _this.text_alignment_values;
                            var item_display = item.link === "#"
                                ? item.display_value
                                : "<a href=\"" + item.link + "\" target=\"_blank\" style=\"color:" + item.color_text + "\">" + item.display_value + "</a>";
                            var tooltip = !item.tooltip || item.tooltip === "-"
                                ? undefined
                                : " data-toggle=\"tooltip\" data-html=\"true\" data-placement=\"auto\" title=\"" + item.tooltip + "\" ";
                            output.body += "\n                    <td style=\"" + item_style + "\">\n                        " + (tooltip ? "<span " + tooltip + ">" : "") + "\n                            " + item_display + "\n                        " + (tooltip ? "</span>" : "") + "\n                    </td>\n                ";
                        });
                        output.body += "</tr>";
                    }
                });
                return output;
            };
            BoomOutput.prototype.getDataAsDebugHTML = function (data) {
                var debugdata = "";
                debugdata = lodash_1.default.map(data, function (d) {
                    return "\n        <tr>\n            <td style=\"padding:4px;text-align:left;width:30%; title=\"Series Name\" >" + d.seriesName + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Matching Pattern Name\" >" + (d.pattern.name || d.pattern.pattern || "Default") + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Value : " + String(d.value_formatted || "null") + " / Raw : " + String(d.value || "null") + " / Stat : " + d.pattern.valueName + "\">" + d.display_value + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Row name\" >" + d.row_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Col name\" >" + d.col_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Thresholds\" >" + d.thresholds.join(",") + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"BG Color\" >" + d.color_bg + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Text Color\" >" + d.color_text + "</td>\n        </tr>\n        ";
                }).join("");
                return debugdata;
            };
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbU91dHB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcHAvYm9vbS9Cb29tT3V0cHV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O1lBSUE7Z0JBU0Usb0JBQVksT0FBOEI7b0JBQ3hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxPQUFPLENBQUMsc0JBQXNCLElBQUksRUFBRSxDQUFDO29CQUNuRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO29CQUNuRCxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUM7b0JBQ3pDLElBQUksQ0FBQywwQkFBMEIsR0FBRyxPQUFPLENBQUMsMEJBQTBCLElBQUksRUFBRSxDQUFDO29CQUMzRSxJQUFJLENBQUMscUJBQXFCLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixJQUFJLEVBQUUsQ0FBQztvQkFDakUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUM7Z0JBQzVELENBQUM7Z0JBQ0gsaUJBQUM7WUFBRCxDQUFDLEFBakJELElBaUJDOztZQUNELFVBQVUsQ0FBQyxTQUFTLENBQUMsYUFBYSxHQUFHLFVBQVUsSUFBZ0IsRUFBRSxhQUFhO2dCQUF6QyxpQkFnRXBDO2dCQS9EQyxJQUFJLGtCQUFrQixHQUFHLFVBQVUsT0FBZSxFQUFFLGlCQUF5QixFQUFFLFdBQW1CO29CQUNoRyxJQUFJLGlCQUFpQixLQUFLLEdBQUcsRUFBRTt3QkFDN0IsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsRUFBRSxzQ0FBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO3dCQUM3SCxPQUFPLEdBQUcsZUFBWSxpQkFBaUIsNkJBQXFCLE9BQU8sU0FBTSxDQUFDO3FCQUMzRTtv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TSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksTUFBTSxDQUFDLGtCQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxXQUFLLENBQUMsQ0FBQyxhQUFhLGtHQUN6SCxDQUFDLENBQUMsUUFBUSxrR0FDVixDQUFDLENBQUMsUUFBUSxvR0FDUixDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsa0dBQ3hCLENBQUMsQ0FBQyxRQUFRLG9HQUNSLENBQUMsQ0FBQyxVQUFVLG1DQUV2RixDQUFDO2dCQUNSLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDWixPQUFPLFNBQVMsQ0FBQztZQUNuQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgeyBJQm9vbUhUTUwsIElCb29tVGFibGUsIElCb29tUmVuZGVyaW5nT3B0aW9ucywgSUJvb21TZXJpZXMgfSBmcm9tIFwiLi9pbmRleFwiO1xuaW1wb3J0IHsgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUb2tlbnMgfSBmcm9tIFwiLi9Cb29tVXRpbHNcIjtcblxuZXhwb3J0IGNsYXNzIEJvb21PdXRwdXQge1xuICBwdWJsaWMgZGVmYXVsdF90aXRsZV9mb3Jfcm93czogU3RyaW5nO1xuICBwdWJsaWMgaGlkZV9maXJzdF9jb2x1bW46IEJvb2xlYW47XG4gIHB1YmxpYyBoaWRlX2hlYWRlcnM6IEJvb2xlYW47XG4gIHB1YmxpYyB0ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbjogU3RyaW5nO1xuICBwdWJsaWMgdGV4dF9hbGlnbm1lbnRfdmFsdWVzOiBTdHJpbmc7XG4gIHB1YmxpYyBmaXJzdF9jb2x1bW5fbGluazogU3RyaW5nO1xuICBwdWJsaWMgZ2V0RGF0YUFzSFRNTDtcbiAgcHVibGljIGdldERhdGFBc0RlYnVnSFRNTDtcbiAgY29uc3RydWN0b3Iob3B0aW9uczogSUJvb21SZW5kZXJpbmdPcHRpb25zKSB7XG4gICAgdGhpcy5kZWZhdWx0X3RpdGxlX2Zvcl9yb3dzID0gb3B0aW9ucy5kZWZhdWx0X3RpdGxlX2Zvcl9yb3dzIHx8IFwiXCI7XG4gICAgdGhpcy5oaWRlX2ZpcnN0X2NvbHVtbiA9IG9wdGlvbnMuaGlkZV9maXJzdF9jb2x1bW47XG4gICAgdGhpcy5oaWRlX2hlYWRlcnMgPSBvcHRpb25zLmhpZGVfaGVhZGVycztcbiAgICB0aGlzLnRleHRfYWxpZ25tZW50X2ZpcnN0Y29sdW1uID0gb3B0aW9ucy50ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbiB8fCBcIlwiO1xuICAgIHRoaXMudGV4dF9hbGlnbm1lbnRfdmFsdWVzID0gb3B0aW9ucy50ZXh0X2FsaWdubWVudF92YWx1ZXMgfHwgXCJcIjtcbiAgICB0aGlzLmZpcnN0X2NvbHVtbl9saW5rID0gb3B0aW9ucy5maXJzdF9jb2x1bW5fbGluayB8fCBcIiNcIjtcbiAgfVxufVxuQm9vbU91dHB1dC5wcm90b3R5cGUuZ2V0RGF0YUFzSFRNTCA9IGZ1bmN0aW9uIChkYXRhOiBJQm9vbVRhYmxlLCBzb3J0aW5nX3Byb3BzKTogSUJvb21IVE1MIHtcbiAgbGV0IGdldExpbmtpZmllZENvbHVtbiA9IGZ1bmN0aW9uIChyb3dOYW1lOiBzdHJpbmcsIGZpcnN0X2NvbHVtbl9saW5rOiBzdHJpbmcsIHJhd19yb3dOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmIChmaXJzdF9jb2x1bW5fbGluayAhPT0gXCIjXCIpIHtcbiAgICAgIGZpcnN0X2NvbHVtbl9saW5rID0gZmlyc3RfY29sdW1uX2xpbmsucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Jvd19uYW1lX1wiLCBcImdcIiksIGdldEFjdHVhbE5hbWVXaXRob3V0VG9rZW5zKHJhd19yb3dOYW1lKS50cmltKCkpO1xuICAgICAgcm93TmFtZSA9IGA8YSBocmVmPVwiJHtmaXJzdF9jb2x1bW5fbGlua31cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke3Jvd05hbWV9PC9hPmA7XG4gICAgfVxuICAgIHJldHVybiByb3dOYW1lO1xuICB9O1xuICBsZXQgb3V0cHV0OiBJQm9vbUhUTUwgPSB7XG4gICAgYm9keTogXCJcIlxuICB9O1xuICBpZiAoc29ydGluZ19wcm9wcyAmJiBzb3J0aW5nX3Byb3BzLmNvbF9pbmRleCAhPT0gdW5kZWZpbmVkICYmIHNvcnRpbmdfcHJvcHMuY29sX2luZGV4ID4gLTEgJiYgZGF0YSAmJiBkYXRhLm91dHB1dCAmJiBkYXRhLm91dHB1dC5sZW5ndGggPj0gc29ydGluZ19wcm9wcy5jb2xfaW5kZXgpIHtcbiAgICBsZXQgc29ydEZ1bmN0aW9uID0gKGEsIGIsIHNvcnRNZXRob2QpID0+IHtcbiAgICAgIGlmIChzb3J0TWV0aG9kID09PSBcImFzY1wiKSB7XG4gICAgICAgIHJldHVybiBhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSAtIGJbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGJbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlIC0gYVtzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWU7XG4gICAgICB9XG4gICAgfTtcbiAgICBkYXRhLm91dHB1dCA9IGRhdGEub3V0cHV0XG4gICAgICAuZmlsdGVyKGEgPT4gIWlzTmFOKGFbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlKSlcbiAgICAgIC5jb25jYXQoZGF0YS5vdXRwdXQuZmlsdGVyKGEgPT4gaXNOYU4oYVtzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUpKSlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBzb3J0RnVuY3Rpb24oYSwgYiwgc29ydGluZ19wcm9wcy5kaXJlY3Rpb24pKTtcbiAgfVxuICBfLmVhY2goZGF0YS5vdXRwdXQsIG8gPT4ge1xuICAgIGlmIChvLm1hcChpdGVtID0+IGl0ZW0uaGlkZGVuLnRvU3RyaW5nKCkpLmluZGV4T2YoXCJmYWxzZVwiKSA+IC0xKSB7XG4gICAgICBvdXRwdXQuYm9keSArPSBcIjx0cj5cIjtcbiAgICAgIGlmICh0aGlzLmhpZGVfZmlyc3RfY29sdW1uICE9PSB0cnVlKSB7XG4gICAgICAgIGxldCByYXdfcm93TmFtZSA9IChfLmZpcnN0KG8ubWFwKGl0ZW0gPT4gaXRlbS5yb3dfbmFtZV9yYXcpKSk7XG4gICAgICAgIG91dHB1dC5ib2R5ICs9IGBcbiAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjoke1xuICAgICAgICAgIHRoaXMudGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW5cbiAgICAgICAgICB9XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAke2dldExpbmtpZmllZENvbHVtbihfLmZpcnN0KG8ubWFwKGl0ZW0gPT4gaXRlbS5yb3dfbmFtZSkpLCBTdHJpbmcodGhpcy5maXJzdF9jb2x1bW5fbGluayksIHJhd19yb3dOYW1lKX1cbiAgICAgICAgICAgICAgICAgICAgPC90ZD5gO1xuICAgICAgfVxuICAgICAgXy5lYWNoKG8sIGl0ZW0gPT4ge1xuICAgICAgICBsZXQgaXRlbV9zdHlsZSA9IGBwYWRkaW5nOjRweDtiYWNrZ3JvdW5kLWNvbG9yOiR7aXRlbS5jb2xvcl9iZ307Y29sb3I6JHtcbiAgICAgICAgICBpdGVtLmNvbG9yX3RleHRcbiAgICAgICAgICB9O3RleHQtYWxpZ246JHt0aGlzLnRleHRfYWxpZ25tZW50X3ZhbHVlc31gO1xuICAgICAgICBsZXQgaXRlbV9kaXNwbGF5ID1cbiAgICAgICAgICBpdGVtLmxpbmsgPT09IFwiI1wiXG4gICAgICAgICAgICA/IGl0ZW0uZGlzcGxheV92YWx1ZVxuICAgICAgICAgICAgOiBgPGEgaHJlZj1cIiR7aXRlbS5saW5rfVwiIHRhcmdldD1cIl9ibGFua1wiIHN0eWxlPVwiY29sb3I6JHtcbiAgICAgICAgICAgIGl0ZW0uY29sb3JfdGV4dFxuICAgICAgICAgICAgfVwiPiR7aXRlbS5kaXNwbGF5X3ZhbHVlfTwvYT5gO1xuICAgICAgICBsZXQgdG9vbHRpcCA9XG4gICAgICAgICAgIWl0ZW0udG9vbHRpcCB8fCBpdGVtLnRvb2x0aXAgPT09IFwiLVwiXG4gICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgOiBgIGRhdGEtdG9nZ2xlPVwidG9vbHRpcFwiIGRhdGEtaHRtbD1cInRydWVcIiBkYXRhLXBsYWNlbWVudD1cImF1dG9cIiB0aXRsZT1cIiR7XG4gICAgICAgICAgICBpdGVtLnRvb2x0aXBcbiAgICAgICAgICAgIH1cIiBgO1xuICAgICAgICBvdXRwdXQuYm9keSArPSBgXG4gICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT1cIiR7aXRlbV9zdHlsZX1cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICR7dG9vbHRpcCA/IGA8c3BhbiAke3Rvb2x0aXB9PmAgOiBcIlwifVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7aXRlbV9kaXNwbGF5fVxuICAgICAgICAgICAgICAgICAgICAgICAgJHt0b29sdGlwID8gYDwvc3Bhbj5gIDogXCJcIn1cbiAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICBgO1xuICAgICAgfSk7XG4gICAgICBvdXRwdXQuYm9keSArPSBcIjwvdHI+XCI7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG91dHB1dDtcbn07XG5Cb29tT3V0cHV0LnByb3RvdHlwZS5nZXREYXRhQXNEZWJ1Z0hUTUwgPSBmdW5jdGlvbiAoZGF0YTogSUJvb21TZXJpZXNbXSk6IHN0cmluZyB7XG4gIGxldCBkZWJ1Z2RhdGEgPSBgYDtcbiAgZGVidWdkYXRhID0gXy5tYXAoZGF0YSwgZCA9PiB7XG4gICAgcmV0dXJuIGBcbiAgICAgICAgPHRyPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjMwJTsgdGl0bGU9XCJTZXJpZXMgTmFtZVwiID4ke2Quc2VyaWVzTmFtZX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJNYXRjaGluZyBQYXR0ZXJuIE5hbWVcIiA+JHtkLnBhdHRlcm4ubmFtZSB8fCBkLnBhdHRlcm4ucGF0dGVybiB8fCBcIkRlZmF1bHRcIn08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJWYWx1ZSA6ICR7U3RyaW5nKGQudmFsdWVfZm9ybWF0dGVkIHx8IFwibnVsbFwiKX0gLyBSYXcgOiAke1N0cmluZyhkLnZhbHVlIHx8IFwibnVsbFwiKX0gLyBTdGF0IDogJHtkLnBhdHRlcm4udmFsdWVOYW1lfVwiPiR7ZC5kaXNwbGF5X3ZhbHVlfTwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlJvdyBuYW1lXCIgPiR7ZC5yb3dfbmFtZX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJDb2wgbmFtZVwiID4ke2QuY29sX25hbWV9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiVGhyZXNob2xkc1wiID4ke2QudGhyZXNob2xkcy5qb2luKFwiLFwiKX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJCRyBDb2xvclwiID4ke2QuY29sb3JfYmd9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiVGV4dCBDb2xvclwiID4ke2QuY29sb3JfdGV4dH08L3RkPlxuICAgICAgICA8L3RyPlxuICAgICAgICBgO1xuICB9KS5qb2luKGBgKTtcbiAgcmV0dXJuIGRlYnVnZGF0YTtcbn07XG4iXX0=