System.register(["lodash", "./index", "./../GrafanaUtils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, index_1, GrafanaUtils_1, getDisplayValueTemplate, getBGColor, getTextColor, getThresholds, getSeriesValue, getLink, getCurrentTimeStamp, doesValueNeedsToHide, replaceDelimitedColumns, getRowName, getColName, GetValuesReplaced;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (index_1_1) {
                index_1 = index_1_1;
            },
            function (GrafanaUtils_1_1) {
                GrafanaUtils_1 = GrafanaUtils_1_1;
            }
        ],
        execute: function () {
            exports_1("getDisplayValueTemplate", getDisplayValueTemplate = function (value, pattern, seriesName, row_col_wrapper, thresholds) {
                var template = "_value_";
                if (lodash_1.default.isNaN(value) || value === null) {
                    template = pattern.null_value || "No data";
                    if (pattern.null_value === "") {
                        template = "";
                    }
                }
                else {
                    template = pattern.displayTemplate || template;
                    if (pattern.enable_transform) {
                        var transform_values = pattern.transform_values.split("|");
                        template = index_1.getItemBasedOnThreshold(thresholds, transform_values, value, template);
                    }
                    if (pattern.enable_transform_overrides && pattern.transform_values_overrides !== "") {
                        var _transform_values_overrides = pattern.transform_values_overrides
                            .split("|")
                            .filter(function (con) { return con.indexOf("->"); })
                            .map(function (con) { return con.split("->"); })
                            .filter(function (con) { return +(con[0]) === value; })
                            .map(function (con) { return con[1]; });
                        if (_transform_values_overrides.length > 0 && _transform_values_overrides[0] !== "") {
                            template = ("" + _transform_values_overrides[0]).trim();
                        }
                    }
                    if (pattern.enable_transform || pattern.enable_transform_overrides) {
                        template = replaceDelimitedColumns(template, seriesName, pattern.delimiter, row_col_wrapper);
                    }
                }
                return template;
            });
            exports_1("getBGColor", getBGColor = function (value, pattern, thresholds, list_of_bgColors_based_on_thresholds, bgColorOverRides) {
                var bgColor = "transparent";
                if (lodash_1.default.isNaN(value) || value === null) {
                    bgColor = pattern.null_color || "darkred";
                    if (pattern.null_color === "") {
                        bgColor = "transparent";
                    }
                }
                else {
                    bgColor = pattern.defaultBGColor || bgColor;
                    if (pattern.enable_bgColor && pattern.bgColors) {
                        bgColor = index_1.getItemBasedOnThreshold(thresholds, list_of_bgColors_based_on_thresholds, value, bgColor);
                    }
                    if (pattern.enable_bgColor_overrides && pattern.bgColors_overrides !== "") {
                        var _bgColors_overrides = bgColorOverRides.filter(function (con) { return con.indexOf("->"); }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                        if (_bgColors_overrides.length > 0 && _bgColors_overrides[0] !== "") {
                            bgColor = ("" + _bgColors_overrides[0]).trim();
                        }
                    }
                }
                return index_1.normalizeColor(bgColor);
            });
            exports_1("getTextColor", getTextColor = function (value, pattern, thresholds, list_of_textColors_based_on_thresholds, txtColorOverrides) {
                var textColor = document.body.classList.contains("theme-light") ? "black" : "white";
                if (lodash_1.default.isNaN(value) || value === null) {
                    textColor = pattern.null_textcolor || textColor;
                }
                else {
                    textColor = pattern.defaultTextColor || textColor;
                    if (pattern.enable_textColor && pattern.textColors) {
                        textColor = index_1.getItemBasedOnThreshold(thresholds, list_of_textColors_based_on_thresholds, value, textColor);
                    }
                    if (pattern.enable_textColor_overrides && pattern.textColors_overrides !== "") {
                        var _textColors_overrides = txtColorOverrides.filter(function (con) { return con.indexOf("->"); }).map(function (con) { return con.split("->"); }).filter(function (con) { return +(con[0]) === value; }).map(function (con) { return con[1]; });
                        if (_textColors_overrides.length > 0 && _textColors_overrides[0] !== "") {
                            textColor = ("" + _textColors_overrides[0]).trim();
                        }
                    }
                }
                return index_1.normalizeColor(textColor);
            });
            exports_1("getThresholds", getThresholds = function (thresholdsArray, enable_time_based_thresholds, time_based_thresholds, currentTimeStamp) {
                if (enable_time_based_thresholds) {
                    var metricrecivedTimeStamp_1 = currentTimeStamp || new Date();
                    var metricrecivedTimeStamp_innumber_1 = metricrecivedTimeStamp_1.getHours() * 100 + metricrecivedTimeStamp_1.getMinutes();
                    var weekdays_1 = ["sun", "mon", "tue", "wed", "thu", "fri", "sat"];
                    lodash_1.default.each(time_based_thresholds, function (tbtx) {
                        if (tbtx && tbtx.from && tbtx.to && tbtx.enabledDays &&
                            (metricrecivedTimeStamp_innumber_1 >= +(tbtx.from)) &&
                            (metricrecivedTimeStamp_innumber_1 <= +(tbtx.to)) &&
                            (tbtx.enabledDays.toLowerCase().indexOf(weekdays_1[metricrecivedTimeStamp_1.getDay()]) > -1) &&
                            tbtx.threshold) {
                            thresholdsArray = (tbtx.threshold + "").split(",").map(function (d) { return +d; });
                        }
                    });
                }
                return thresholdsArray || [];
            });
            exports_1("getSeriesValue", getSeriesValue = function (series, statType) {
                var value = NaN;
                if (statType === "last_time") {
                    if (lodash_1.default.last(series.datapoints)) {
                        value = lodash_1.default.last(series.datapoints)[1];
                    }
                }
                else if (statType === "last_time_nonnull") {
                    var non_null_data = series.datapoints.filter(function (s) { return s[0]; });
                    if (lodash_1.default.last(non_null_data) && lodash_1.default.last(non_null_data)[1]) {
                        value = lodash_1.default.last(non_null_data)[1];
                    }
                }
                else if (series.stats) {
                    value = series.stats[statType];
                }
                return value;
            });
            exports_1("getLink", getLink = function (enable_clickable_cells, clickable_cells_link, range) {
                var link = enable_clickable_cells ? clickable_cells_link || "#" : "#";
                if (link && link !== "#") {
                    link += (link.indexOf("?") > -1 ? "&from=" + range.from : "?from=" + range.from);
                    link += "&to=" + range.to;
                }
                return link;
            });
            exports_1("getCurrentTimeStamp", getCurrentTimeStamp = function (dataPoints) {
                var currentTimeStamp = new Date();
                if (dataPoints && dataPoints.length > 0 && lodash_1.default.last(dataPoints).length === 2) {
                    currentTimeStamp = new Date(lodash_1.default.last(dataPoints)[1]);
                }
                return currentTimeStamp;
            });
            exports_1("doesValueNeedsToHide", doesValueNeedsToHide = function (value, filter) {
                var hidden = false;
                if ((value || value === 0) && filter && (filter.value_below !== "" || filter.value_above !== "")) {
                    if (filter.value_below !== "" && value < +(filter.value_below)) {
                        hidden = true;
                    }
                    if (filter.value_above !== "" && value > +(filter.value_above)) {
                        hidden = true;
                    }
                }
                return hidden;
            });
            exports_1("replaceDelimitedColumns", replaceDelimitedColumns = function (inputstring, seriesName, delimiter, row_col_wrapper) {
                var outputString = seriesName
                    .split(delimiter || ".")
                    .reduce(function (r, it, i) {
                    return r.replace(new RegExp(row_col_wrapper + i + row_col_wrapper, "g"), it);
                }, inputstring);
                return outputString;
            });
            exports_1("getRowName", getRowName = function (row_name, delimiter, row_col_wrapper, seriesName, _metricname, _tags) {
                if (delimiter.toLowerCase() === "tag") {
                    row_name = row_name.replace(new RegExp("{{metric_name}}", "g"), _metricname);
                    row_name = index_1.replace_tags_from_field(row_name, _tags);
                }
                else {
                    row_name = replaceDelimitedColumns(row_name, seriesName, delimiter, row_col_wrapper);
                    if (seriesName.split(delimiter || ".").length === 1) {
                        row_name = seriesName;
                    }
                }
                return row_name.replace(new RegExp("_series_", "g"), seriesName.toString());
            });
            exports_1("getColName", getColName = function (col_name, delimiter, row_col_wrapper, seriesName, row_name, _metricname, _tags) {
                if (delimiter.toLowerCase() === "tag") {
                    col_name = col_name.replace(new RegExp("{{metric_name}}", "g"), _metricname);
                    row_name = index_1.replace_tags_from_field(col_name, _tags);
                }
                else {
                    col_name = replaceDelimitedColumns(col_name, seriesName, delimiter, row_col_wrapper);
                    if (seriesName.split(delimiter || ".").length === 1 || row_name === seriesName) {
                        col_name = col_name || "Value";
                    }
                }
                return col_name.replace(new RegExp("_series_", "g"), seriesName.toString());
            });
            exports_1("GetValuesReplaced", GetValuesReplaced = function (strToReplace, value, valueformatted, stats, decimals, format, _metricname, _tags, delimiter) {
                var value_raw = lodash_1.default.isNaN(value) || value === null ? "null" : value.toString().trim();
                var value_formatted = lodash_1.default.isNaN(value) || value === null ? "null" : valueformatted.toString().trim();
                strToReplace = strToReplace.replace(new RegExp("_value_min_raw_", "g"), stats.min);
                strToReplace = strToReplace.replace(new RegExp("_value_max_raw_", "g"), stats.max);
                strToReplace = strToReplace.replace(new RegExp("_value_avg_raw_", "g"), stats.avg);
                strToReplace = strToReplace.replace(new RegExp("_value_current_raw_", "g"), stats.current);
                strToReplace = strToReplace.replace(new RegExp("_value_total_raw_", "g"), stats.total);
                strToReplace = strToReplace.replace(new RegExp("_value_raw_", "g"), value_raw);
                strToReplace = strToReplace.replace(new RegExp("_value_min_", "g"), GrafanaUtils_1.get_formatted_value(stats.min, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_max_", "g"), GrafanaUtils_1.get_formatted_value(stats.max, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_avg_", "g"), GrafanaUtils_1.get_formatted_value(stats.avg, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_current_", "g"), GrafanaUtils_1.get_formatted_value(stats.current, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_total_", "g"), GrafanaUtils_1.get_formatted_value(stats.total, decimals, format));
                strToReplace = strToReplace.replace(new RegExp("_value_", "g"), value_formatted);
                if (delimiter.toLowerCase() === "tag") {
                    strToReplace = strToReplace.replace(new RegExp("{{metric_name}}", "g"), _metricname);
                    strToReplace = index_1.replace_tags_from_field(strToReplace, _tags);
                }
                return strToReplace;
            });
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbVNlcmllc1V0aWxzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2FwcC9ib29tL0Jvb21TZXJpZXNVdGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztZQU1BLHFDQUFXLHVCQUF1QixHQUFHLFVBQVUsS0FBYSxFQUFFLE9BQXFCLEVBQUUsVUFBa0IsRUFBRSxlQUF1QixFQUFFLFVBQWlCO2dCQUMvSSxJQUFJLFFBQVEsR0FBRyxTQUFTLENBQUM7Z0JBQ3pCLElBQUksZ0JBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxLQUFLLElBQUksRUFBRTtvQkFDbEMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLElBQUksU0FBUyxDQUFDO29CQUMzQyxJQUFJLE9BQU8sQ0FBQyxVQUFVLEtBQUssRUFBRSxFQUFFO3dCQUMzQixRQUFRLEdBQUcsRUFBRSxDQUFDO3FCQUNqQjtpQkFDSjtxQkFBTTtvQkFDSCxRQUFRLEdBQUcsT0FBTyxDQUFDLGVBQWUsSUFBSSxRQUFRLENBQUM7b0JBQy9DLElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUFFO3dCQUMxQixJQUFJLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQzNELFFBQVEsR0FBRywrQkFBdUIsQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO3FCQUNyRjtvQkFDRCxJQUFJLE9BQU8sQ0FBQywwQkFBMEIsSUFBSSxPQUFPLENBQUMsMEJBQTBCLEtBQUssRUFBRSxFQUFFO3dCQUNqRixJQUFJLDJCQUEyQixHQUFHLE9BQU8sQ0FBQywwQkFBMEI7NkJBQy9ELEtBQUssQ0FBQyxHQUFHLENBQUM7NkJBQ1YsTUFBTSxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFB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RUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUM5SCxZQUFZLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxlQUFlLEVBQUUsR0FBRyxDQUFDLEVBQUUsa0NBQW1CLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDMUgsWUFBWSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxFQUFFLGVBQWUsQ0FBQyxDQUFDO2dCQUVqRixJQUFJLFNBQVMsQ0FBQyxXQUFXLEVBQUUsS0FBSyxLQUFLLEVBQUU7b0JBQ25DLFlBQVksR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO29CQUNyRixZQUFZLEdBQUcsK0JBQXVCLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO2lCQUMvRDtnQkFFRCxPQUFPLFlBQVksQ0FBQztZQUN4QixDQUFDLEVBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tIFwibG9kYXNoXCI7XHJcblxyXG5pbXBvcnQgeyBnZXRJdGVtQmFzZWRPblRocmVzaG9sZCwgbm9ybWFsaXplQ29sb3IsIHJlcGxhY2VfdGFnc19mcm9tX2ZpZWxkIH0gZnJvbSBcIi4vaW5kZXhcIjtcclxuaW1wb3J0IHsgZ2V0X2Zvcm1hdHRlZF92YWx1ZSB9IGZyb20gXCIuLy4uL0dyYWZhbmFVdGlsc1wiO1xyXG5pbXBvcnQgeyBJQm9vbVBhdHRlcm4gfSBmcm9tIFwiLi9Cb29tLmludGVyZmFjZVwiO1xyXG5cclxuZXhwb3J0IGxldCBnZXREaXNwbGF5VmFsdWVUZW1wbGF0ZSA9IGZ1bmN0aW9uICh2YWx1ZTogbnVtYmVyLCBwYXR0ZXJuOiBJQm9vbVBhdHRlcm4sIHNlcmllc05hbWU6IHN0cmluZywgcm93X2NvbF93cmFwcGVyOiBzdHJpbmcsIHRocmVzaG9sZHM6IGFueVtdKTogc3RyaW5nIHtcclxuICAgIGxldCB0ZW1wbGF0ZSA9IFwiX3ZhbHVlX1wiO1xyXG4gICAgaWYgKF8uaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgdGVtcGxhdGUgPSBwYXR0ZXJuLm51bGxfdmFsdWUgfHwgXCJObyBkYXRhXCI7XHJcbiAgICAgICAgaWYgKHBhdHRlcm4ubnVsbF92YWx1ZSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0ZW1wbGF0ZSA9IHBhdHRlcm4uZGlzcGxheVRlbXBsYXRlIHx8IHRlbXBsYXRlO1xyXG4gICAgICAgIGlmIChwYXR0ZXJuLmVuYWJsZV90cmFuc2Zvcm0pIHtcclxuICAgICAgICAgICAgbGV0IHRyYW5zZm9ybV92YWx1ZXMgPSBwYXR0ZXJuLnRyYW5zZm9ybV92YWx1ZXMuc3BsaXQoXCJ8XCIpO1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IGdldEl0ZW1CYXNlZE9uVGhyZXNob2xkKHRocmVzaG9sZHMsIHRyYW5zZm9ybV92YWx1ZXMsIHZhbHVlLCB0ZW1wbGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXR0ZXJuLmVuYWJsZV90cmFuc2Zvcm1fb3ZlcnJpZGVzICYmIHBhdHRlcm4udHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXMgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgbGV0IF90cmFuc2Zvcm1fdmFsdWVzX292ZXJyaWRlcyA9IHBhdHRlcm4udHJhbnNmb3JtX3ZhbHVlc19vdmVycmlkZXNcclxuICAgICAgICAgICAgICAgIC5zcGxpdChcInxcIilcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoY29uID0+IGNvbi5pbmRleE9mKFwiLT5cIikpXHJcbiAgICAgICAgICAgICAgICAubWFwKGNvbiA9PiBjb24uc3BsaXQoXCItPlwiKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoY29uID0+ICsoY29uWzBdKSA9PT0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICAubWFwKGNvbiA9PiBjb25bMV0pO1xyXG4gICAgICAgICAgICBpZiAoX3RyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzLmxlbmd0aCA+IDAgJiYgX3RyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzWzBdICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9IChcIlwiICsgX3RyYW5zZm9ybV92YWx1ZXNfb3ZlcnJpZGVzWzBdKS50cmltKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHBhdHRlcm4uZW5hYmxlX3RyYW5zZm9ybSB8fCBwYXR0ZXJuLmVuYWJsZV90cmFuc2Zvcm1fb3ZlcnJpZGVzKSB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlID0gcmVwbGFjZURlbGltaXRlZENvbHVtbnModGVtcGxhdGUsIHNlcmllc05hbWUsIHBhdHRlcm4uZGVsaW1pdGVyLCByb3dfY29sX3dyYXBwZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB0ZW1wbGF0ZTtcclxufTtcclxuZXhwb3J0IGxldCBnZXRCR0NvbG9yID0gZnVuY3Rpb24gKHZhbHVlOiBudW1iZXIsIHBhdHRlcm46IElCb29tUGF0dGVybiwgdGhyZXNob2xkczogYW55W10sIGxpc3Rfb2ZfYmdDb2xvcnNfYmFzZWRfb25fdGhyZXNob2xkczogc3RyaW5nW10sIGJnQ29sb3JPdmVyUmlkZXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcclxuICAgIGxldCBiZ0NvbG9yID0gXCJ0cmFuc3BhcmVudFwiO1xyXG4gICAgaWYgKF8uaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgYmdDb2xvciA9IHBhdHRlcm4ubnVsbF9jb2xvciB8fCBcImRhcmtyZWRcIjtcclxuICAgICAgICBpZiAocGF0dGVybi5udWxsX2NvbG9yID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGJnQ29sb3IgPSBcInRyYW5zcGFyZW50XCI7XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBiZ0NvbG9yID0gcGF0dGVybi5kZWZhdWx0QkdDb2xvciB8fCBiZ0NvbG9yO1xyXG4gICAgICAgIGlmIChwYXR0ZXJuLmVuYWJsZV9iZ0NvbG9yICYmIHBhdHRlcm4uYmdDb2xvcnMpIHtcclxuICAgICAgICAgICAgYmdDb2xvciA9IGdldEl0ZW1CYXNlZE9uVGhyZXNob2xkKHRocmVzaG9sZHMsIGxpc3Rfb2ZfYmdDb2xvcnNfYmFzZWRfb25fdGhyZXNob2xkcywgdmFsdWUsIGJnQ29sb3IpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHBhdHRlcm4uZW5hYmxlX2JnQ29sb3Jfb3ZlcnJpZGVzICYmIHBhdHRlcm4uYmdDb2xvcnNfb3ZlcnJpZGVzICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgIGxldCBfYmdDb2xvcnNfb3ZlcnJpZGVzID0gYmdDb2xvck92ZXJSaWRlcy5maWx0ZXIoY29uID0+IGNvbi5pbmRleE9mKFwiLT5cIikpLm1hcChjb24gPT4gY29uLnNwbGl0KFwiLT5cIikpLmZpbHRlcihjb24gPT4gKyhjb25bMF0pID09PSB2YWx1ZSkubWFwKGNvbiA9PiBjb25bMV0pO1xyXG4gICAgICAgICAgICBpZiAoX2JnQ29sb3JzX292ZXJyaWRlcy5sZW5ndGggPiAwICYmIF9iZ0NvbG9yc19vdmVycmlkZXNbMF0gIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGJnQ29sb3IgPSAoXCJcIiArIF9iZ0NvbG9yc19vdmVycmlkZXNbMF0pLnRyaW0oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBub3JtYWxpemVDb2xvcihiZ0NvbG9yKTtcclxufTtcclxuZXhwb3J0IGxldCBnZXRUZXh0Q29sb3IgPSBmdW5jdGlvbiAodmFsdWU6IG51bWJlciwgcGF0dGVybjogSUJvb21QYXR0ZXJuLCB0aHJlc2hvbGRzLCBsaXN0X29mX3RleHRDb2xvcnNfYmFzZWRfb25fdGhyZXNob2xkczogc3RyaW5nLCB0eHRDb2xvck92ZXJyaWRlczogc3RyaW5nW10pOiBzdHJpbmcge1xyXG4gICAgbGV0IHRleHRDb2xvciA9IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKFwidGhlbWUtbGlnaHRcIikgPyBcImJsYWNrXCIgOiBcIndoaXRlXCI7XHJcbiAgICBpZiAoXy5pc05hTih2YWx1ZSkgfHwgdmFsdWUgPT09IG51bGwpIHtcclxuICAgICAgICB0ZXh0Q29sb3IgPSBwYXR0ZXJuLm51bGxfdGV4dGNvbG9yIHx8IHRleHRDb2xvcjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGV4dENvbG9yID0gcGF0dGVybi5kZWZhdWx0VGV4dENvbG9yIHx8IHRleHRDb2xvcjtcclxuICAgICAgICBpZiAocGF0dGVybi5lbmFibGVfdGV4dENvbG9yICYmIHBhdHRlcm4udGV4dENvbG9ycykge1xyXG4gICAgICAgICAgICB0ZXh0Q29sb3IgPSBnZXRJdGVtQmFzZWRPblRocmVzaG9sZCh0aHJlc2hvbGRzLCBsaXN0X29mX3RleHRDb2xvcnNfYmFzZWRfb25fdGhyZXNob2xkcywgdmFsdWUsIHRleHRDb2xvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXR0ZXJuLmVuYWJsZV90ZXh0Q29sb3Jfb3ZlcnJpZGVzICYmIHBhdHRlcm4udGV4dENvbG9yc19vdmVycmlkZXMgIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgbGV0IF90ZXh0Q29sb3JzX292ZXJyaWRlcyA9IHR4dENvbG9yT3ZlcnJpZGVzLmZpbHRlcihjb24gPT4gY29uLmluZGV4T2YoXCItPlwiKSkubWFwKGNvbiA9PiBjb24uc3BsaXQoXCItPlwiKSkuZmlsdGVyKGNvbiA9PiArKGNvblswXSkgPT09IHZhbHVlKS5tYXAoY29uID0+IGNvblsxXSk7XHJcbiAgICAgICAgICAgIGlmIChfdGV4dENvbG9yc19vdmVycmlkZXMubGVuZ3RoID4gMCAmJiBfdGV4dENvbG9yc19vdmVycmlkZXNbMF0gIT09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHRleHRDb2xvciA9IChcIlwiICsgX3RleHRDb2xvcnNfb3ZlcnJpZGVzWzBdKS50cmltKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbm9ybWFsaXplQ29sb3IodGV4dENvbG9yKTtcclxufTtcclxuZXhwb3J0IGxldCBnZXRUaHJlc2hvbGRzID0gZnVuY3Rpb24gKHRocmVzaG9sZHNBcnJheTogYW55W10sIGVuYWJsZV90aW1lX2Jhc2VkX3RocmVzaG9sZHM6IGJvb2xlYW4sIHRpbWVfYmFzZWRfdGhyZXNob2xkczogYW55W10sIGN1cnJlbnRUaW1lU3RhbXA6IERhdGUpIHtcclxuICAgIGlmIChlbmFibGVfdGltZV9iYXNlZF90aHJlc2hvbGRzKSB7XHJcbiAgICAgICAgbGV0IG1ldHJpY3JlY2l2ZWRUaW1lU3RhbXAgPSBjdXJyZW50VGltZVN0YW1wIHx8IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgbGV0IG1ldHJpY3JlY2l2ZWRUaW1lU3RhbXBfaW5udW1iZXIgPSBtZXRyaWNyZWNpdmVkVGltZVN0YW1wLmdldEhvdXJzKCkgKiAxMDAgKyBtZXRyaWNyZWNpdmVkVGltZVN0YW1wLmdldE1pbnV0ZXMoKTtcclxuICAgICAgICBsZXQgd2Vla2RheXMgPSBbXCJzdW5cIiwgXCJtb25cIiwgXCJ0dWVcIiwgXCJ3ZWRcIiwgXCJ0aHVcIiwgXCJmcmlcIiwgXCJzYXRcIl07XHJcbiAgICAgICAgXy5lYWNoKHRpbWVfYmFzZWRfdGhyZXNob2xkcywgKHRidHgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRidHggJiYgdGJ0eC5mcm9tICYmIHRidHgudG8gJiYgdGJ0eC5lbmFibGVkRGF5cyAmJlxyXG4gICAgICAgICAgICAgICAgKG1ldHJpY3JlY2l2ZWRUaW1lU3RhbXBfaW5udW1iZXIgPj0gKyh0YnR4LmZyb20pKSAmJlxyXG4gICAgICAgICAgICAgICAgKG1ldHJpY3JlY2l2ZWRUaW1lU3RhbXBfaW5udW1iZXIgPD0gKyh0YnR4LnRvKSkgJiZcclxuICAgICAgICAgICAgICAgICh0YnR4LmVuYWJsZWREYXlzLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih3ZWVrZGF5c1ttZXRyaWNyZWNpdmVkVGltZVN0YW1wLmdldERheSgpXSkgPiAtMSkgJiZcclxuICAgICAgICAgICAgICAgIHRidHgudGhyZXNob2xkXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgdGhyZXNob2xkc0FycmF5ID0gKHRidHgudGhyZXNob2xkICsgXCJcIikuc3BsaXQoXCIsXCIpLm1hcChkID0+ICtkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRocmVzaG9sZHNBcnJheSB8fCBbXTtcclxufTtcclxuZXhwb3J0IGxldCBnZXRTZXJpZXNWYWx1ZSA9IGZ1bmN0aW9uIChzZXJpZXM6IGFueSwgc3RhdFR5cGU6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICBsZXQgdmFsdWUgPSBOYU47XHJcbiAgICBpZiAoc3RhdFR5cGUgPT09IFwibGFzdF90aW1lXCIpIHtcclxuICAgICAgICBpZiAoXy5sYXN0KHNlcmllcy5kYXRhcG9pbnRzKSkge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IF8ubGFzdChzZXJpZXMuZGF0YXBvaW50cylbMV07XHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChzdGF0VHlwZSA9PT0gXCJsYXN0X3RpbWVfbm9ubnVsbFwiKSB7XHJcbiAgICAgICAgbGV0IG5vbl9udWxsX2RhdGEgPSBzZXJpZXMuZGF0YXBvaW50cy5maWx0ZXIocyA9PiBzWzBdKTtcclxuICAgICAgICBpZiAoXy5sYXN0KG5vbl9udWxsX2RhdGEpICYmIF8ubGFzdChub25fbnVsbF9kYXRhKVsxXSkge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IF8ubGFzdChub25fbnVsbF9kYXRhKVsxXTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHNlcmllcy5zdGF0cykge1xyXG4gICAgICAgIHZhbHVlID0gc2VyaWVzLnN0YXRzW3N0YXRUeXBlXTtcclxuICAgIH1cclxuICAgIHJldHVybiB2YWx1ZTtcclxufTtcclxuZXhwb3J0IGxldCBnZXRMaW5rID0gZnVuY3Rpb24gKGVuYWJsZV9jbGlja2FibGVfY2VsbHM6IGJvb2xlYW4sIGNsaWNrYWJsZV9jZWxsc19saW5rOiBzdHJpbmcsIHJhbmdlOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgbGV0IGxpbmsgPSBlbmFibGVfY2xpY2thYmxlX2NlbGxzID8gY2xpY2thYmxlX2NlbGxzX2xpbmsgfHwgXCIjXCIgOiBcIiNcIjtcclxuICAgIGlmIChsaW5rICYmIGxpbmsgIT09IFwiI1wiKSB7XHJcbiAgICAgICAgbGluayArPSAobGluay5pbmRleE9mKFwiP1wiKSA+IC0xID8gYCZmcm9tPSR7cmFuZ2UuZnJvbX1gIDogYD9mcm9tPSR7cmFuZ2UuZnJvbX1gKTtcclxuICAgICAgICBsaW5rICs9IGAmdG89JHtyYW5nZS50b31gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxpbms7XHJcbn07XHJcbmV4cG9ydCBsZXQgZ2V0Q3VycmVudFRpbWVTdGFtcCA9IGZ1bmN0aW9uIChkYXRhUG9pbnRzOiBhbnlbXSk6IERhdGUge1xyXG4gICAgbGV0IGN1cnJlbnRUaW1lU3RhbXAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgaWYgKGRhdGFQb2ludHMgJiYgZGF0YVBvaW50cy5sZW5ndGggPiAwICYmIF8ubGFzdChkYXRhUG9pbnRzKS5sZW5ndGggPT09IDIpIHtcclxuICAgICAgICBjdXJyZW50VGltZVN0YW1wID0gbmV3IERhdGUoXy5sYXN0KGRhdGFQb2ludHMpWzFdKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjdXJyZW50VGltZVN0YW1wO1xyXG59O1xyXG5leHBvcnQgbGV0IGRvZXNWYWx1ZU5lZWRzVG9IaWRlID0gZnVuY3Rpb24gKHZhbHVlOiBudW1iZXIsIGZpbHRlcjogYW55KTogYm9vbGVhbiB7XHJcbiAgICBsZXQgaGlkZGVuID0gZmFsc2U7XHJcbiAgICBpZiAoKHZhbHVlIHx8IHZhbHVlID09PSAwKSAmJiBmaWx0ZXIgJiYgKGZpbHRlci52YWx1ZV9iZWxvdyAhPT0gXCJcIiB8fCBmaWx0ZXIudmFsdWVfYWJvdmUgIT09IFwiXCIpKSB7XHJcbiAgICAgICAgaWYgKGZpbHRlci52YWx1ZV9iZWxvdyAhPT0gXCJcIiAmJiB2YWx1ZSA8ICsoZmlsdGVyLnZhbHVlX2JlbG93KSkge1xyXG4gICAgICAgICAgICBoaWRkZW4gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZmlsdGVyLnZhbHVlX2Fib3ZlICE9PSBcIlwiICYmIHZhbHVlID4gKyhmaWx0ZXIudmFsdWVfYWJvdmUpKSB7XHJcbiAgICAgICAgICAgIGhpZGRlbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhpZGRlbjtcclxufTtcclxuZXhwb3J0IGxldCByZXBsYWNlRGVsaW1pdGVkQ29sdW1ucyA9IGZ1bmN0aW9uIChpbnB1dHN0cmluZzogc3RyaW5nLCBzZXJpZXNOYW1lOiBzdHJpbmcsIGRlbGltaXRlcjogc3RyaW5nLCByb3dfY29sX3dyYXBwZXI6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBsZXQgb3V0cHV0U3RyaW5nID0gc2VyaWVzTmFtZVxyXG4gICAgICAgIC5zcGxpdChkZWxpbWl0ZXIgfHwgXCIuXCIpXHJcbiAgICAgICAgLnJlZHVjZSgociwgaXQsIGkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHIucmVwbGFjZShuZXcgUmVnRXhwKHJvd19jb2xfd3JhcHBlciArIGkgKyByb3dfY29sX3dyYXBwZXIsIFwiZ1wiKSwgaXQpO1xyXG4gICAgICAgIH0sIGlucHV0c3RyaW5nKTtcclxuICAgIHJldHVybiBvdXRwdXRTdHJpbmc7XHJcbn07XHJcbmV4cG9ydCBsZXQgZ2V0Um93TmFtZSA9IGZ1bmN0aW9uIChyb3dfbmFtZTogc3RyaW5nLCBkZWxpbWl0ZXI6IHN0cmluZywgcm93X2NvbF93cmFwcGVyOiBzdHJpbmcsIHNlcmllc05hbWU6IHN0cmluZywgX21ldHJpY25hbWU6IHN0cmluZywgX3RhZ3M6IGFueVtdKTogc3RyaW5nIHtcclxuICAgIGlmIChkZWxpbWl0ZXIudG9Mb3dlckNhc2UoKSA9PT0gXCJ0YWdcIikge1xyXG4gICAgICAgIHJvd19uYW1lID0gcm93X25hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwie3ttZXRyaWNfbmFtZX19XCIsIFwiZ1wiKSwgX21ldHJpY25hbWUpO1xyXG4gICAgICAgIHJvd19uYW1lID0gcmVwbGFjZV90YWdzX2Zyb21fZmllbGQocm93X25hbWUsIF90YWdzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcm93X25hbWUgPSByZXBsYWNlRGVsaW1pdGVkQ29sdW1ucyhyb3dfbmFtZSwgc2VyaWVzTmFtZSwgZGVsaW1pdGVyLCByb3dfY29sX3dyYXBwZXIpO1xyXG4gICAgICAgIGlmIChzZXJpZXNOYW1lLnNwbGl0KGRlbGltaXRlciB8fCBcIi5cIikubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgIHJvd19uYW1lID0gc2VyaWVzTmFtZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcm93X25hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Nlcmllc19cIiwgXCJnXCIpLCBzZXJpZXNOYW1lLnRvU3RyaW5nKCkpO1xyXG59O1xyXG5leHBvcnQgbGV0IGdldENvbE5hbWUgPSBmdW5jdGlvbiAoY29sX25hbWU6IHN0cmluZywgZGVsaW1pdGVyOiBzdHJpbmcsIHJvd19jb2xfd3JhcHBlcjogc3RyaW5nLCBzZXJpZXNOYW1lOiBzdHJpbmcsIHJvd19uYW1lOiBzdHJpbmcsIF9tZXRyaWNuYW1lOiBzdHJpbmcsIF90YWdzOiBhbnlbXSk6IHN0cmluZyB7XHJcbiAgICBpZiAoZGVsaW1pdGVyLnRvTG93ZXJDYXNlKCkgPT09IFwidGFnXCIpIHtcclxuICAgICAgICBjb2xfbmFtZSA9IGNvbF9uYW1lLnJlcGxhY2UobmV3IFJlZ0V4cChcInt7bWV0cmljX25hbWV9fVwiLCBcImdcIiksIF9tZXRyaWNuYW1lKTtcclxuICAgICAgICByb3dfbmFtZSA9IHJlcGxhY2VfdGFnc19mcm9tX2ZpZWxkKGNvbF9uYW1lLCBfdGFncyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbF9uYW1lID0gcmVwbGFjZURlbGltaXRlZENvbHVtbnMoY29sX25hbWUsIHNlcmllc05hbWUsIGRlbGltaXRlciwgcm93X2NvbF93cmFwcGVyKTtcclxuICAgICAgICBpZiAoc2VyaWVzTmFtZS5zcGxpdChkZWxpbWl0ZXIgfHwgXCIuXCIpLmxlbmd0aCA9PT0gMSB8fCByb3dfbmFtZSA9PT0gc2VyaWVzTmFtZSkge1xyXG4gICAgICAgICAgICBjb2xfbmFtZSA9IGNvbF9uYW1lIHx8IFwiVmFsdWVcIjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29sX25hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwiX3Nlcmllc19cIiwgXCJnXCIpLCBzZXJpZXNOYW1lLnRvU3RyaW5nKCkpO1xyXG59O1xyXG5leHBvcnQgbGV0IEdldFZhbHVlc1JlcGxhY2VkID0gZnVuY3Rpb24gKHN0clRvUmVwbGFjZTogc3RyaW5nLCB2YWx1ZSwgdmFsdWVmb3JtYXR0ZWQsIHN0YXRzOiBhbnksIGRlY2ltYWxzOiBOdW1iZXIsIGZvcm1hdDogc3RyaW5nLCBfbWV0cmljbmFtZTogc3RyaW5nLCBfdGFnczogYW55W10sIGRlbGltaXRlcjogc3RyaW5nKTogc3RyaW5nIHtcclxuXHJcbiAgICBsZXQgdmFsdWVfcmF3ID0gXy5pc05hTih2YWx1ZSkgfHwgdmFsdWUgPT09IG51bGwgPyBcIm51bGxcIiA6IHZhbHVlLnRvU3RyaW5nKCkudHJpbSgpO1xyXG4gICAgbGV0IHZhbHVlX2Zvcm1hdHRlZCA9IF8uaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBudWxsID8gXCJudWxsXCIgOiB2YWx1ZWZvcm1hdHRlZC50b1N0cmluZygpLnRyaW0oKTtcclxuXHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX21pbl9yYXdfXCIsIFwiZ1wiKSwgc3RhdHMubWluKTtcclxuICAgIHN0clRvUmVwbGFjZSA9IHN0clRvUmVwbGFjZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfbWF4X3Jhd19cIiwgXCJnXCIpLCBzdGF0cy5tYXgpO1xyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9hdmdfcmF3X1wiLCBcImdcIiksIHN0YXRzLmF2Zyk7XHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX2N1cnJlbnRfcmF3X1wiLCBcImdcIiksIHN0YXRzLmN1cnJlbnQpO1xyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV90b3RhbF9yYXdfXCIsIFwiZ1wiKSwgc3RhdHMudG90YWwpO1xyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9yYXdfXCIsIFwiZ1wiKSwgdmFsdWVfcmF3KTtcclxuXHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX21pbl9cIiwgXCJnXCIpLCBnZXRfZm9ybWF0dGVkX3ZhbHVlKHN0YXRzLm1pbiwgZGVjaW1hbHMsIGZvcm1hdCkpO1xyXG4gICAgc3RyVG9SZXBsYWNlID0gc3RyVG9SZXBsYWNlLnJlcGxhY2UobmV3IFJlZ0V4cChcIl92YWx1ZV9tYXhfXCIsIFwiZ1wiKSwgZ2V0X2Zvcm1hdHRlZF92YWx1ZShzdGF0cy5tYXgsIGRlY2ltYWxzLCBmb3JtYXQpKTtcclxuICAgIHN0clRvUmVwbGFjZSA9IHN0clRvUmVwbGFjZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfYXZnX1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc3RhdHMuYXZnLCBkZWNpbWFscywgZm9ybWF0KSk7XHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX2N1cnJlbnRfXCIsIFwiZ1wiKSwgZ2V0X2Zvcm1hdHRlZF92YWx1ZShzdGF0cy5jdXJyZW50LCBkZWNpbWFscywgZm9ybWF0KSk7XHJcbiAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwiX3ZhbHVlX3RvdGFsX1wiLCBcImdcIiksIGdldF9mb3JtYXR0ZWRfdmFsdWUoc3RhdHMudG90YWwsIGRlY2ltYWxzLCBmb3JtYXQpKTtcclxuICAgIHN0clRvUmVwbGFjZSA9IHN0clRvUmVwbGFjZS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJfdmFsdWVfXCIsIFwiZ1wiKSwgdmFsdWVfZm9ybWF0dGVkKTtcclxuXHJcbiAgICBpZiAoZGVsaW1pdGVyLnRvTG93ZXJDYXNlKCkgPT09IFwidGFnXCIpIHtcclxuICAgICAgICBzdHJUb1JlcGxhY2UgPSBzdHJUb1JlcGxhY2UucmVwbGFjZShuZXcgUmVnRXhwKFwie3ttZXRyaWNfbmFtZX19XCIsIFwiZ1wiKSwgX21ldHJpY25hbWUpO1xyXG4gICAgICAgIHN0clRvUmVwbGFjZSA9IHJlcGxhY2VfdGFnc19mcm9tX2ZpZWxkKHN0clRvUmVwbGFjZSwgX3RhZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzdHJUb1JlcGxhY2U7XHJcbn07XHJcbiJdfQ==